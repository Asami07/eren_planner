<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Eren'in Pro Planner v12</title>
    
    <meta name="theme-color" content="#2c3e50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="manifest" href="data:application/manifest+json,{'name':'ErenPlanner','short_name':'Planner','start_url':'.','display':'standalone','background_color':'#f4f7f6','theme_color':'#2c3e50','icons':[{'src':'https://cdn-icons-png.flaticon.com/512/3209/3209265.png','sizes':'512x512','type':'image/png'}]}">

    <style>
        :root { --primary: #4a90e2; --secondary: #f39c12; --special: #9b59b6; --routine: #2ecc71; --bg: #f4f7f6; --text: #2c3e50; --success: #2ecc71; --danger: #e74c3c; --undo: #34495e; --hp-color: #ff4757; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); padding: 10px; margin: 0; user-select: none; }
        .container { width: 100%; max-width: 600px; margin: auto; }
        
        /* Stats & Bars */
        .stats-container { background: #2c3e50; color: white; padding: 15px; border-radius: 15px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; }
        .bar-bg { background: rgba(255,255,255,0.1); height: 10px; border-radius: 5px; overflow: hidden; margin-bottom: 10px; }
        .xp-fill { background: var(--success); height: 100%; transition: 0.5s ease; width: 0%; }
        .hp-fill { background: var(--hp-color); height: 100%; transition: 0.5s ease; width: 100%; }

        /* Input Area */
        .input-area { background: white; padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #eee; }
        .input-row { display: flex; gap: 8px; margin-bottom: 10px; }
        input, select { padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; flex: 1; }
        .add-btn { width: 100%; background: var(--primary); color: white; border: none; padding: 14px; border-radius: 10px; font-weight: bold; font-size: 1rem; }

        /* Task List */
        .column { background: white; padding: 15px; border-radius: 15px; border: 1px solid #eee; }
        .task-item { display: flex; align-items: center; padding: 12px; border-bottom: 1px solid #f1f1f1; }
        .task-item:last-child { border-bottom: none; }
        .task-item.completed span { text-decoration: line-through; opacity: 0.5; }
        .time-tag { font-size: 0.75rem; color: var(--primary); font-weight: bold; margin-right: 10px; background: #eef5ff; padding: 2px 6px; border-radius: 4px; }
        
        .notif-btn { background: #fff3cd; color: #856404; padding: 10px; border-radius: 10px; margin-bottom: 10px; text-align: center; font-size: 0.85rem; border: 1px solid #ffeeba; cursor: pointer; }
    </style>
</head>
<body>

    <div class="container">
        <div id="notifBanner" class="notif-btn" onclick="requestPermission()">
            üîî Bildirimleri ve Hatƒ±rlatƒ±cƒ±larƒ± A√ß
        </div>

        <div class="stats-container">
            <div class="stat-row">
                <span>‚≠ê Level <span id="level">1</span></span>
                <span><span id="score">0</span> XP</span>
            </div>
            <div class="bar-bg"><div id="xpBar" class="xp-fill"></div></div>
            
            <div class="stat-row">
                <span style="color:var(--hp-color)">‚ù§Ô∏è Health (HP)</span>
                <span id="hpText">100/100</span>
            </div>
            <div class="bar-bg"><div id="hpBar" class="hp-fill"></div></div>
        </div>

        <div class="input-area">
            <div class="input-row">
                <input type="text" id="taskInput" placeholder="G√∂rev nedir?">
                <select id="taskType" style="flex: 0.4;">
                    <option value="daily">G√ºnl√ºk</option>
                    <option value="routine">Rutin</option>
                </select>
            </div>
            <div class="input-row" style="align-items: center;">
                <span style="font-size: 0.8rem; color: #666;">Hatƒ±rlatƒ±cƒ±:</span>
                <input type="time" id="taskTime">
            </div>
            <button class="add-btn" onclick="addTask()">G√∂revi Ba≈ülat</button>
        </div>

        <div class="column">
            <h3 style="margin-top:0">G√∂rev Listesi</h3>
            <div id="taskList"></div>
        </div>
    </div>

    <script>
        // --- VERƒ∞ KURTARMA VE BA≈ûLATMA ---
        const oldScore = parseInt(localStorage.getItem('score')) || 0;
        const oldTasks = JSON.parse(localStorage.getItem('tasks')) || [];
        
        let state = JSON.parse(localStorage.getItem('planner_state')) || {
            tasks: oldTasks,
            score: oldScore,
            hp: 100,
            lastCheck: new Date().toDateString()
        };

        // Eski verileri temizle (Artƒ±k yeni sisteme ge√ßtik)
        if(localStorage.getItem('score')) {
            localStorage.removeItem('score');
            localStorage.removeItem('tasks');
        }

        const XP_PER_LEVEL = 500;

        function requestPermission() {
            Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                    document.getElementById('notifBanner').style.display = 'none';
                    new Notification("Harika!", { body: "Bildirimler aktif edildi." });
                }
            });
        }

        function updateUI() {
            checkPenalty(); // G√ºn deƒüi≈ütiyse cezayƒ± uygula
            
            const list = document.getElementById('taskList');
            list.innerHTML = '';
            
            // Stats
            const level = Math.floor(state.score / XP_PER_LEVEL) + 1;
            const currentLevelXp = state.score % XP_PER_LEVEL;
            
            document.getElementById('level').innerText = level;
            document.getElementById('score').innerText = state.score;
            document.getElementById('xpBar').style.width = (currentLevelXp / XP_PER_LEVEL * 100) + "%";
            
            document.getElementById('hpBar').style.width = state.hp + "%";
            document.getElementById('hpText').innerText = state.hp + "/100";
            
            // Task List
            state.tasks.forEach((task, index) => {
                const el = document.createElement('div');
                el.className = `task-item ${task.completed ? 'completed' : ''}`;
                const timeHtml = task.time ? `<span class="time-tag">${task.time}</span>` : '';
                
                el.innerHTML = `
                    <input type="checkbox" style="width:20px; height:20px; margin-right:12px;" ${task.completed ? 'checked' : ''} onchange="toggleTask(${index})">
                    ${timeHtml}
                    <span style="flex:1">${task.text}</span>
                    <button onclick="deleteTask(${index})" style="background:none; border:none; color:#ff4757; font-size:1.2rem; margin-left:10px;">√ó</button>
                `;
                list.appendChild(el);
            });

            localStorage.setItem('planner_state', JSON.stringify(state));
        }

        function addTask() {
            const input = document.getElementById('taskInput');
            const type = document.getElementById('taskType').value;
            const time = document.getElementById('taskTime').value;

            if (!input.value.trim()) return;

            state.tasks.push({
                text: input.value,
                type: type,
                time: time,
                completed: false,
                notified: false,
                created: new Date().toDateString()
            });

            input.value = '';
            document.getElementById('taskTime').value = '';
            updateUI();
        }

        function toggleTask(index) {
            const task = state.tasks[index];
            task.completed = !task.completed;
            state.score += task.completed ? 20 : -20;
            if(state.score < 0) state.score = 0;
            updateUI();
        }

        function deleteTask(index) {
            state.tasks.splice(index, 1);
            updateUI();
        }

        function checkPenalty() {
            const today = new Date().toDateString();
            if (state.lastCheck !== today) {
                // Sadece "g√ºnl√ºk" tipindeki ve tamamlanmamƒ±≈ü g√∂revler i√ßin ceza ver
                const failedTasks = state.tasks.filter(t => t.type === 'daily' && !t.completed);
                const penalty = failedTasks.length * 10;

                if (penalty > 0) {
                    state.hp -= penalty;
                    alert(`D√ºn yapmadƒ±ƒüƒ±n ${failedTasks.length} g√∂rev i√ßin ${penalty} HP kaybettin!`);
                }

                if (state.hp <= 0) {
                    state.score = Math.max(0, state.score - XP_PER_LEVEL);
                    state.hp = 100;
                    alert("Canƒ±n bitti! Level d√º≈üt√ºn ve canƒ±n yenilendi.");
                }

                // Yeni g√ºnde g√ºnl√ºk g√∂revlerin durumunu sƒ±fƒ±rla (Rutinler gibi)
                state.tasks.forEach(t => { if(t.type === 'daily') t.completed = false; t.notified = false; });
                state.lastCheck = today;
            }
        }

        // Bildirim Kontrol D√∂ng√ºs√º (Her 30 saniyede bir)
        setInterval(() => {
            if (Notification.permission !== "granted") return;
            
            const now = new Date();
            const currentTime = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');

            state.tasks.forEach(task => {
                if (task.time === currentTime && !task.completed && !task.notified) {
                    new Notification("G√∂rev Vakti! üéØ", {
                        body: task.text,
                        icon: 'https://cdn-icons-png.flaticon.com/512/3209/3209265.png'
                    });
                    task.notified = true;
                    localStorage.setItem('planner_state', JSON.stringify(state));
                }
            });
        }, 30000);

        // ƒ∞lk a√ßƒ±lƒ±≈üta bildirim butonunu gizle/g√∂ster
        if (Notification.permission === "granted") {
            document.getElementById('notifBanner').style.display = 'none';
        }

        updateUI();
    </script>
</body>
</html>

